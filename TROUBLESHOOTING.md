# Решение проблем - Белый экран

## Что было исправлено

Добавлены следующие улучшения для предотвращения белого экрана:

1. **ErrorBoundary** - перехватывает ошибки React и показывает понятное сообщение
2. **Улучшенная обработка ошибок БД** - игра продолжит работать даже если БД недоступна
3. **Fallback для sql.js** - если CDN недоступен, используется локальная версия
4. **Экран загрузки** - показывает индикатор загрузки вместо белого экрана
5. **Логирование ошибок** - все ошибки логируются в консоль браузера

## Диагностика

### Шаг 1: Откройте консоль браузера

1. Нажмите `F12` или `Ctrl+Shift+I` (Windows) / `Cmd+Option+I` (Mac)
2. Перейдите на вкладку **Console**
3. Посмотрите на ошибки (они будут красного цвета)

### Шаг 2: Проверьте ошибки

#### Если видите ошибку загрузки sql.js:
```
Ошибка инициализации базы данных: ...
```

**Решение:**
- Проверьте подключение к интернету (sql.js загружается с CDN)
- Или дождитесь загрузки - игра попробует использовать локальную версию

#### Если видите ошибку React:
```
ErrorBoundary caught an error: ...
```

**Решение:**
- Нажмите кнопку "Перезагрузить страницу" в сообщении об ошибке
- Или обновите страницу вручную (`F5`)

#### Если консоль пустая:
- Проверьте вкладку **Network** - возможно, не загружаются ресурсы
- Проверьте вкладку **Application** → **Storage** - возможно, проблема с IndexedDB

## Быстрое решение

### Вариант 1: Очистка кэша и перезагрузка

1. Откройте консоль (`F12`)
2. Выполните в консоли:
```javascript
// Очистка всех данных
localStorage.clear()
indexedDB.deleteDatabase('keyval-store')
location.reload()
```

### Вариант 2: Перезапуск dev сервера

1. Остановите сервер (`Ctrl+C` в терминале)
2. Запустите снова:
```bash
npm run dev
```

### Вариант 3: Переустановка зависимостей

```bash
rm -rf node_modules package-lock.json
npm install
npm run dev
```

## Проверка работоспособности

После исправления вы должны увидеть:

1. **При первом запуске:**
   - Экран загрузки с индикатором
   - В консоли: "Создана новая база данных"
   - В консоли: "Питомец создан"

2. **При повторном запуске:**
   - Экран загрузки с индикатором
   - В консоли: "База данных загружена из IndexedDB"
   - В консоли: "Загружен существующий питомец"

3. **Если БД недоступна:**
   - Предупреждение в консоли
   - Игра работает без сохранения
   - Сообщение об ошибке вверху экрана

## Частые проблемы

### Проблема: Белый экран без ошибок в консоли

**Возможные причины:**
- React не может отрендерить компонент
- Проблема с импортами

**Решение:**
1. Проверьте, что все файлы сохранены
2. Перезапустите dev сервер
3. Очистите кэш браузера (`Ctrl+Shift+Delete`)

### Проблема: Ошибка "Cannot read property of undefined"

**Возможные причины:**
- Компонент пытается использовать данные до их загрузки

**Решение:**
- Уже исправлено - добавлена проверка загрузки
- Если проблема остается, проверьте консоль на конкретную ошибку

### Проблема: sql.js не загружается

**Возможные причины:**
- Нет подключения к интернету
- Блокировщик рекламы блокирует CDN
- Проблемы с CORS

**Решение:**
1. Проверьте подключение к интернету
2. Отключите блокировщик рекламы для этого сайта
3. Игра должна автоматически использовать локальную версию sql.js

## Отладка

### Включение детального логирования

В консоли браузера выполните:
```javascript
localStorage.setItem('debug', 'true')
location.reload()
```

### Просмотр состояния БД

В консоли браузера выполните:
```javascript
// Проверка IndexedDB
indexedDB.databases().then(dbs => console.log('Databases:', dbs))

// Проверка localStorage
console.log('Session ID:', localStorage.getItem('tamagotchi_session_id'))
```

### Сброс игры

В консоли браузера выполните:
```javascript
// Полный сброс
localStorage.clear()
indexedDB.deleteDatabase('keyval-store')
location.reload()
```

## Если ничего не помогает

1. **Создайте issue** с описанием проблемы:
   - Что вы видите (белый экран, ошибка и т.д.)
   - Что написано в консоли браузера
   - Какие шаги вы предприняли

2. **Проверьте версии:**
   ```bash
   node --version
   npm --version
   ```

3. **Попробуйте другой браузер:**
   - Chrome/Edge
   - Firefox
   - Safari

## Контакты для помощи

Если проблема не решена, предоставьте:
- Скриншот консоли браузера
- Версию Node.js и npm
- Версию браузера
- Операционную систему

